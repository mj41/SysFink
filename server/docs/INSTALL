# Base SysFink server install documentation.

# Upgade perl
yum upgrade perl

# Install DBD::SQLite
yum install perl-DBD-SQLite


# -- CPAN Module install to ~/sysfink-cpan -----------------
#
# See http://search.cpan.org/~andk/CPAN/lib/CPAN.pm#FAQ or 'man CPAN'.

mkdir ~/sysfink-cpan
mkdir ~/sysfink-cpan/lib
export PERL5LIB=/root/sysfink-cpan/lib

# Run 'cpan' and inside it:

o conf makepl_arg "LIB=~/sysfink-cpan/lib INSTALLMAN1DIR=~/sysfink-cpan/man/man1 INSTALLMAN3DIR=~/sysfink-cpan/man/man3 INSTALLSCRIPT=~/sysfink-cpan/bin INSTALLBIN=~/sysfink-cpan/bin"
o conf mbuildpl_arg "--lib=~/sysfink-cpan/lib --installman1dir=~/sysfink-cpan/man/man1 --installman3dir=~/sysfink-cpan/man/man3 --installscript=~/sysfink-cpan/bin --installbin=~/sysfink-cpan/bin"
o conf halt_on_failure on

install TAP::Harness

install Class::Singleton

install Spiffy
install DateTime::Locale
install DateTime::TimeZone
install DateTime

install JSON

install Config::Multi

install Test::Tester
install DBIx::Class

install Net::OpenSSH
install YAML::Any
install YAML::XS

# For some devel utils.
# install SQL::Translator

exit

# You should call e.g. 'export PERL5LIB=/root/sysfink-cpan/lib' before running any SysFink command.


# -- SySFink  ----------------------------------------------

# Login as root to server machine.
# Check out ~/sysfink if not exists: svn co http://sysfink.googlecode.com/svn/trunk ~/sysfink


# -- Client ------------------------------------------------

cd ~/sysfink/client

perl t/harness.pl


# -- Server ------------------------------------------------

cd ~/sysfink/server

# Create/edit server config files.
cp conf/web.yml.example conf/web.yml
cp conf/web_db.yml.example conf/web_db.yml

# Create client's machine config files
cat > conf-machines/my-first-machine
hostname    my-first-machine.my-domain.com
dist_type   linux-perl-md5
exclude     /dev/* /home/* /proc/* /sys/* /var/*
Ctrl+D

# Import server SSH key/certificate for user 'root' to my-first-machine.my-domain.com

# Create empty db file
cp sysfink-base-stable.db sysfink.db

# Load config files to database
perl utils/conf-to-db.pl

# Run SysFink servers' tests
perl t/harness.pl

# Check if you can run SysFink server
perl sysfink.pl --help

